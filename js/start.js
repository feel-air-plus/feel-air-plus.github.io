var milkcocoa = new MilkCocoa("eggipdy4kpy.mlkcca.com");var groupDataStore = milkcocoa.dataStore("group");var userDataStore = milkcocoa.dataStore("user");var iconDataStore = milkcocoa.dataStore("icon");var groupList;window.onload = function(){    // 画面描画時    // グループデータストア内の項目を一覧で取得    groupDataStore.stream().sort("desc").next(function(err, datas) {        groupList = datas;        // 取得したグループ情報を画面のセレクトボックスに反映        datas.forEach(function(data) {            createGroupRow(data);        });    });    // アイコンデータストア内の項目を一覧で取得    iconDataStore.stream().sort("desc").next(function(err, datas) {        // 取得したアイコン情報を元に画面のラジオボタンに反映        datas.forEach(function(data) {            createIconRow(data);                    });    });    // ラジオボタンデフォルト選択指定    $("input[name='iconStatus']").val([0]);};function createGroupRow(data){    // グループのセレクトボックス要素を生成    $('.selectgroup').append(    '<option value="'    + data.value.groupName    + '">'    + data.value.groupName    + '</option>');};function createIconRow(data){    // アイコンのラジオボタン要素を生成    var iconName = data.value.iconName;    var iconUrl = data.value.url;    $('.icon-radio-row').append('<label class='    + iconName    + '>'    + '<input type="radio" name="iconStatus"'    + 'value="'    + data.value.iconId    + '" onClick="changeImg()" ></label>');    $('.'+iconName).addClass("crobd");    $('.'+iconName).css('background', 'url('    + iconUrl    + ') no-repeat left top');};function enterChatMap() {    alert("ボタン押下");    var groupEnterLimit = 4;    var userName = $(".input__field")[0].value;    var selectedGroup = $(".selectgroup")[0].value;    var selectedIcon = $("input[name='iconStatus']:checked").val();    // 選択しているグループの入室上限チェック    for(var i=0;i<groupList.length;i++){        if(groupList[i].value.groupName==selectedGroup){            if(groupList[i].value.count == groupEnterLimit){                alert("入室上限なり。");                // 暫定的にグループ入室上限に0をセット                groupDataStore.set(groupList[i].id, { 'count' : 0});              return;            }else{                // 入室上限を+1                var num = groupList[i].value.count + 1;                groupDataStore.set(groupList[i].id, { 'count' : num});            }        }    }    // 入力されたユーザ名文字数上限チェック    if(userName.length > 5){        alert("ユーザ名が上限文字数(5文字)を超えています。");        return;    }else if(!userName.length){        alert("ユーザ名が入力されていません。");        return;           }    // ユーザIDを作成    var currentDate = dateFormatYYYYMMDDHHNNSS(new Date);    var userId = selectedGroup + selectedIcon + currentDate;    alert(userId);    // ユーザ情報をユーザデータストアに反映    userDataStore.push(        {            userId : userId,            userName  : userName,            groupName : selectedGroup,            selectedIconValue : selectedIcon        },        function(err, pushed){        },        function(err) {            console.log("userDataStore push failed "+err);        }    )    // ユーザ情報をセッションストレージに格納    sessionStorage.clear();    sessionStorage.setItem('userId', userId);    // sessionStorage.getItem('test');    var chatMapUrl = "../chatMap.html";    location.href = chatMapUrl;};function changeImg() {	$('label').removeClass('selected');	var radioVal = $('input[name=iconStatus]:checked').val() - 1;	$('label:eq(' + radioVal + ')').addClass('selected');}